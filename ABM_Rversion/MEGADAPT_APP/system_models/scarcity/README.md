# MEGADAPT Scarcity Model

## Folder structure

* MEGADAPT_APP
    + systems_models 
        - flooding_ponding
        - scarcity
        - health
            * inputs

## Install required R libraries

Run R and install the package `pacman`:

    > install.packages("pacman")

Use pacman to install and load the packages `tidyverse`, `pscl`:

    > pacman::p_load(tidyverse, pscl)


## How it works

### Diagnostic Graphics

The script generates graphs to observe the behavior of each of the variables of interest

### Zero Inflated Model (Negative Binomial)

Because the data on disruption have an excess of zeros, it was decided to use a _Zero inflated Negative Binomial_ (ZINB) model.

This model suggests that the excess of zeros is generated by a process different from that of the data and that therefore, it can be modeled independently.

Due to the significance of the predictive value of some variables the final model adjusted is:

#### For the zeroes (binomial model)

The only predictive variables is `V_SAGUA`, number of houses without water. 

<a href="https://www.codecogs.com/eqnedit.php?latex=\frac{\theta}{1&space;-&space;\theta}&space;=&space;exp&space;\left\{&space;\beta_0&space;&plus;&space;\beta_1&space;\times&space;V\_SAGUA&space;\right\}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\frac{\theta}{1&space;-&space;\theta}&space;=&space;exp&space;\left\{&space;\beta_0&space;&plus;&space;\beta_1&space;\times&space;V\_SAGUA&space;\right\}" title="\frac{\theta}{1 - \theta} = exp \left\{ \beta_0 + \beta_1 \times V\_SAGUA \right\}" /></a>

#### For the count model (negative binomial model)

The predictive variables are `CRITICO`, if the ageb has less than 4 hours of water per day, and `N_ANTIGUEDAD`, oldness of the infrastructure (standardized).

<a href="https://www.codecogs.com/eqnedit.php?latex=\lambda&space;=&space;exp&space;\left\{&space;\beta_0&space;&plus;&space;\beta_1&space;\times&space;CRITICO&space;&plus;&space;\beta_2&space;\times&space;N\_ANTIGUEDAD&space;\right\}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\lambda&space;=&space;exp&space;\left\{&space;\beta_0&space;&plus;&space;\beta_1&space;\times&space;CRITICO&space;&plus;&space;\beta_2&space;\times&space;N\_ANTIGUEDAD&space;\right\}" title="\lambda = exp \left\{ \beta_0 + \beta_1 \times CRITICO + \beta_2 \times N\_ANTIGUEDAD \right\}" /></a>

    > modelo_zip_escasez <- zeroinfl(lambdas ~ FUGAS + N_ANTIGUEDAD + V_SAGUA | N_ANTIGUEDAD + V_SAGUA + CRITICO, 
      dist = "negbin", data = dat_fugas)

## Inputs

### Scarcity data

The model only consider scarcity data by AGEB. A $\lambda$ (average number of days without water) is modeled for each AGEB according to the number of days without water per **deputation**. 

input/datos_final2.csv

## Outputs

The model, as a generalized linear model, return the coeficientes for both the zeroes and count models.

| Parameters | Count model | Zero model |
|:----------:|:-----------:|:----------:|
| Beta 0     |  0.70446    | -1.48033   |
| Beta 1     |  0.44646    | -129.70579 |
| Beta 2     | -0.02439    |            |  


### Binomial Model (Zeros)

<a href="https://www.codecogs.com/eqnedit.php?latex=\frac{\theta}{1&space;-&space;\theta}&space;=&space;exp&space;\left\{&space;-1.48033&space;-&space;129.70579&space;\times&space;V\_SAGUA&space;\right\}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\frac{\theta}{1&space;-&space;\theta}&space;=&space;exp&space;\left\{&space;-1.48033&space;-&space;129.70579&space;\times&space;V\_SAGUA&space;\right\}" title="\frac{\theta}{1 - \theta} = exp \left\{ -1.48033 - 129.70579 \times V\_SAGUA \right\}" /></a>

### Negative Binomial Model (Counts)

<a href="https://www.codecogs.com/eqnedit.php?latex=\lambda&space;=&space;exp\left\{&space;0.70446&space;&plus;&space;0.44646&space;\times&space;CRITICO&space;-&space;0.02439&space;\times&space;N\_ANTIGUEDAD&space;\right\}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\lambda&space;=&space;exp\left\{&space;0.70446&space;&plus;&space;0.44646&space;\times&space;CRITICO&space;-&space;0.02439&space;\times&space;N\_ANTIGUEDAD&space;\right\}" title="\lambda = exp\left\{ 0.70446 + 0.44646 \times CRITICO - 0.02439 \times N\_ANTIGUEDAD \right\}" /></a>



